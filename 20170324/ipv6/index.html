<!DOCTYPE html>
<html lang="ja">
	<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="@pyar6329">
<meta name="description" content="tech blog">
<meta name="generator" content="Hugo 0.19" />
<title>あなたのお家の光回線速度を上げる方法</title>
<link rel="shortcut icon" href="https://b.pyar.bz/images/favicon.ico">
<link rel="stylesheet" href="https://b.pyar.bz/css/style.css">
<link rel="stylesheet" href="https://b.pyar.bz/css/highlight.css">

<link rel="stylesheet" href="https://b.pyar.bz/css/layout.css">



<link rel="stylesheet" href="https://b.pyar.bz/css/monosocialiconsfont.css">



<link href="https://b.pyar.bz/index.xml" rel="alternate" type="application/rss+xml" title="pyar.bz" />


<meta property="og:title" content="あなたのお家の光回線速度を上げる方法" />
<meta property="og:description" content="目次  ネットワークの基礎知識 回線速度の測定方法 回線速度が遅い原因を特定する なぜ遅いのか 遅くなった原因 どうすれば速くなるか IPv6&#43; IPoEを使う 使われている事例 実際にどうすればいいか 結論  ネットワークの基礎知識  ONU(光回線終端装置、モデム)  光信号とデジタル信号を変換するもの ルータと一体型になってるものもある 壁に埋め込まれているものもある  ルータ  普通1ネットワークに対し1台しか接続出来ないが、複数台接続できるようにするもの PPPoEやNAT、DHCPなどがある ONUと一体型のものもある  PPPoE  プロバイダと接続するための認証  NAT  外部ネットワークと内部ネットワークのIPアドレスを変換するもの 内部で外部ネットワークのIPとは別のIPを割り振ることで、IP枯渇問題を解決した  DHCP  IPアドレスを自動的に割り振るもの   回線速度の測定方法 speed testのサイトを使い、昼と夜(18:00頃)の速度を計測する 速度計測サイトのサーバが遠いと結果も遅くなるので、できるだけ国内のテストサービスをつかう 以下がよく使われる計測サイト。別に他のサイトでもいい
 USEN BNR  基本的に、昼は速く、夜は遅い
測定結果が100Mbps契約の場合、20Mbps以上出ていなかったら遅い
また、自分の住んでいる地区の速度と比較してみる
上記のspeed testをして、速度が遅いかどうかを判断する
ちなみに自分の家の場合(フレッツ光ネクストマンションタイプ、 so-net 100Mbps契約、PC直繋ぎ有線LAN)
ベストエフォートとはいえ、452.23Kbps(= 0.45Mbps)&hellip;あれ1/200以下？
この速度は、
 画像が昔みたく表示される場合がある 画像がダウンロードされない ゲームなんて画像ないようなもの git cloneがタイムアウトする 今のスマホテザリング(LTE)でも、20Mbpsは行く  回線速度が遅い原因を特定する speed test後、速度が遅いとわかったら原因を特定していく" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://b.pyar.bz/20170324/ipv6" />



<meta property="article:published_time" content="2017-03-24T00:19:00-09:00"/>
<meta property="article:modified_time" content="2017-03-24T00:19:00-09:00"/>













<meta itemprop="name" content="あなたのお家の光回線速度を上げる方法">
<meta itemprop="description" content="目次  ネットワークの基礎知識 回線速度の測定方法 回線速度が遅い原因を特定する なぜ遅いのか 遅くなった原因 どうすれば速くなるか IPv6&#43; IPoEを使う 使われている事例 実際にどうすればいいか 結論  ネットワークの基礎知識  ONU(光回線終端装置、モデム)  光信号とデジタル信号を変換するもの ルータと一体型になってるものもある 壁に埋め込まれているものもある  ルータ  普通1ネットワークに対し1台しか接続出来ないが、複数台接続できるようにするもの PPPoEやNAT、DHCPなどがある ONUと一体型のものもある  PPPoE  プロバイダと接続するための認証  NAT  外部ネットワークと内部ネットワークのIPアドレスを変換するもの 内部で外部ネットワークのIPとは別のIPを割り振ることで、IP枯渇問題を解決した  DHCP  IPアドレスを自動的に割り振るもの   回線速度の測定方法 speed testのサイトを使い、昼と夜(18:00頃)の速度を計測する 速度計測サイトのサーバが遠いと結果も遅くなるので、できるだけ国内のテストサービスをつかう 以下がよく使われる計測サイト。別に他のサイトでもいい
 USEN BNR  基本的に、昼は速く、夜は遅い
測定結果が100Mbps契約の場合、20Mbps以上出ていなかったら遅い
また、自分の住んでいる地区の速度と比較してみる
上記のspeed testをして、速度が遅いかどうかを判断する
ちなみに自分の家の場合(フレッツ光ネクストマンションタイプ、 so-net 100Mbps契約、PC直繋ぎ有線LAN)
ベストエフォートとはいえ、452.23Kbps(= 0.45Mbps)&hellip;あれ1/200以下？
この速度は、
 画像が昔みたく表示される場合がある 画像がダウンロードされない ゲームなんて画像ないようなもの git cloneがタイムアウトする 今のスマホテザリング(LTE)でも、20Mbpsは行く  回線速度が遅い原因を特定する speed test後、速度が遅いとわかったら原因を特定していく">


<meta itemprop="dateModified" content="2017-03-24T00:19:00-09:00" />
<meta itemprop="wordCount" content="324">



<meta itemprop="keywords" content="programming,ネットワーク,プログラミング,環境構築,開発手法,api,basic,binstubs,capybara,coffee,command,config,controller,datetime,db,erb,er図,factory_girl,foreigner,gem,get,git,github,github-flow,guard,haml,has_one,heroku,intellij,ip,ipoe,ipv4,ipv6,isp,java,java8,jbuilder,json,jst,kvs,less,mac,match,migrate,model,network,newrelic,nosql,oreilly,parse,ping,postgres,postgresql,production,pry,public,rails,rails4,rake,redis,routing,rspec,ruby,sass,scaffold,scss,slim,speedtest,spring,table,test,timestamp,timezone,travis,type,uri,url,utc,vagrant,vne,yaml,オライリー,グローバル参照,コマンド,スリープ,チーム,テーブル,デプロイ,パース,メモ,ルーティング,図解,外部キー,外部キー制約,外部キー嫌い,多対多,時間,環境変数," />



  <meta name="twitter:card" content="summary"/>



<meta name="twitter:text:title" content="あなたのお家の光回線速度を上げる方法"/>
<meta name="twitter:title" content="あなたのお家の光回線速度を上げる方法"/>
<meta name="twitter:description" content="目次  ネットワークの基礎知識 回線速度の測定方法 回線速度が遅い原因を特定する なぜ遅いのか 遅くなった原因 どうすれば速くなるか IPv6&#43; IPoEを使う 使われている事例 実際にどうすればいいか 結論  ネットワークの基礎知識  ONU(光回線終端装置、モデム)  光信号とデジタル信号を変換するもの ルータと一体型になってるものもある 壁に埋め込まれているものもある  ルータ  普通1ネットワークに対し1台しか接続出来ないが、複数台接続できるようにするもの PPPoEやNAT、DHCPなどがある ONUと一体型のものもある  PPPoE  プロバイダと接続するための認証  NAT  外部ネットワークと内部ネットワークのIPアドレスを変換するもの 内部で外部ネットワークのIPとは別のIPを割り振ることで、IP枯渇問題を解決した  DHCP  IPアドレスを自動的に割り振るもの   回線速度の測定方法 speed testのサイトを使い、昼と夜(18:00頃)の速度を計測する 速度計測サイトのサーバが遠いと結果も遅くなるので、できるだけ国内のテストサービスをつかう 以下がよく使われる計測サイト。別に他のサイトでもいい
 USEN BNR  基本的に、昼は速く、夜は遅い
測定結果が100Mbps契約の場合、20Mbps以上出ていなかったら遅い
また、自分の住んでいる地区の速度と比較してみる
上記のspeed testをして、速度が遅いかどうかを判断する
ちなみに自分の家の場合(フレッツ光ネクストマンションタイプ、 so-net 100Mbps契約、PC直繋ぎ有線LAN)
ベストエフォートとはいえ、452.23Kbps(= 0.45Mbps)&hellip;あれ1/200以下？
この速度は、
 画像が昔みたく表示される場合がある 画像がダウンロードされない ゲームなんて画像ないようなもの git cloneがタイムアウトする 今のスマホテザリング(LTE)でも、20Mbpsは行く  回線速度が遅い原因を特定する speed test後、速度が遅いとわかったら原因を特定していく"/>



    </head>
<body>
    <nav class="main-nav">
	
		<a href='https://b.pyar.bz/'> <span class="arrow">←</span>Home</a>
	

	

	
		<a class="cta" href="https://b.pyar.bz/index.xml">Subscribe</a>
	
</nav>

    <section id="wrapper">
        
        
<article class="post">
    <header>
        <h1>あなたのお家の光回線速度を上げる方法</h1>
        <h2 class="headline">
        March 24, 2017
        <br>
        
        
            
                <a href="https://b.pyar.bz/tags/ipv6">IPv6</a>
            
                <a href="https://b.pyar.bz/tags/ipoe">IPoE</a>
            
                <a href="https://b.pyar.bz/tags/ip">IP</a>
            
                <a href="https://b.pyar.bz/tags/isp">ISP</a>
            
                <a href="https://b.pyar.bz/tags/vne">VNE</a>
            
                <a href="https://b.pyar.bz/tags/ipv4">IPv4</a>
            
                <a href="https://b.pyar.bz/tags/network">network</a>
            
                <a href="https://b.pyar.bz/tags/speedtest">speedtest</a>
            
        
        
        </h2>
    </header>
    <section id="post-body">
        

<h2 id="目次">目次</h2>

<ul>
<li>ネットワークの基礎知識</li>
<li>回線速度の測定方法</li>
<li>回線速度が遅い原因を特定する</li>
<li>なぜ遅いのか</li>
<li>遅くなった原因</li>
<li>どうすれば速くなるか</li>
<li>IPv6+ IPoEを使う</li>
<li>使われている事例</li>
<li>実際にどうすればいいか</li>
<li>結論</li>
</ul>

<h2 id="ネットワークの基礎知識">ネットワークの基礎知識</h2>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/000_network.jpg" alt="" /></p>

<ul>
<li>ONU(光回線終端装置、モデム)

<ul>
<li>光信号とデジタル信号を変換するもの</li>
<li>ルータと一体型になってるものもある</li>
<li>壁に埋め込まれているものもある</li>
</ul></li>
<li>ルータ

<ul>
<li>普通1ネットワークに対し1台しか接続出来ないが、複数台接続できるようにするもの</li>
<li>PPPoEやNAT、DHCPなどがある</li>
<li>ONUと一体型のものもある</li>
</ul></li>
<li>PPPoE

<ul>
<li>プロバイダと接続するための認証</li>
</ul></li>
<li>NAT

<ul>
<li>外部ネットワークと内部ネットワークのIPアドレスを変換するもの</li>
<li>内部で外部ネットワークのIPとは別のIPを割り振ることで、IP枯渇問題を解決した</li>
</ul></li>
<li>DHCP

<ul>
<li>IPアドレスを自動的に割り振るもの</li>
</ul></li>
</ul>

<h2 id="回線速度の測定方法">回線速度の測定方法</h2>

<p>speed testのサイトを使い、昼と夜(18:00頃)の速度を計測する
速度計測サイトのサーバが遠いと結果も遅くなるので、できるだけ国内のテストサービスをつかう
以下がよく使われる計測サイト。別に他のサイトでもいい</p>

<ul>
<li><a href="http://www.usen.com/speedtest02/">USEN</a></li>
<li><a href="http://www.musen-lan.com/speed/">BNR</a></li>
</ul>

<p>基本的に、昼は速く、夜は遅い</p>

<p>測定結果が100Mbps契約の場合、20Mbps以上出ていなかったら遅い</p>

<p>また、<a href="http://netspeed.studio-radish.com/cgi-bin/netspeed/openresult/openresult.cgi">自分の住んでいる地区の速度と比較してみる</a></p>

<p>上記のspeed testをして、速度が遅いかどうかを判断する</p>

<p>ちなみに自分の家の場合(フレッツ光ネクストマンションタイプ、 so-net 100Mbps契約、PC直繋ぎ有線LAN)</p>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/001_low_speed.png" alt="" /></p>

<p><a href="https://ja.wikipedia.org/wiki/ベストエフォート">ベストエフォート</a>とはいえ、452.23Kbps(= 0.45Mbps)&hellip;あれ1/200以下？</p>

<p>この速度は、</p>

<ul>
<li><a href="https://www.youtube.com/watch?v=hzHOzAHENzk">画像が昔みたく表示される</a>場合がある</li>
<li>画像がダウンロードされない</li>
<li>ゲームなんて画像ないようなもの</li>
<li>git cloneがタイムアウトする</li>
<li>今のスマホテザリング(LTE)でも、20Mbpsは行く</li>
</ul>

<h2 id="回線速度が遅い原因を特定する">回線速度が遅い原因を特定する</h2>

<p>speed test後、速度が遅いとわかったら原因を特定していく</p>

<p>まず有線LAN接続なのか、無線LAN接続なのかを判断する</p>

<p>無線LAN接続の場合は、有線LANで速度を再び計測する。
ここで速度が向上したらルータの無線LANの部分が原因。11ac対応のルータ(asus, tp-link, NEC等)を買うべき。</p>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/002_no_wifi.jpg" alt="" /></p>

<p>有線LANで速度が遅いと思ったら、今度はルータを外してPCとONU(光回線終端装置、モデム)を直繋ぎして測定する。
ここで速度が向上したらルータの有線LANの部分、ケーブル、もしくはPCのLANが古いのが原因。</p>

<ul>
<li>ルータは1000BASE-T(=1000Mbps)対応のもの(airmac expressとかは100BASE-Tなので遅い)</li>
<li>LANケーブルはcat5e もしくは cat6のものを買う。cat7は無駄だから買わないほうがいい。</li>
<li>PC側も1000BASE-T対応のものにする(大体は対応している)。USBで有線LANにしている場合は、USB3のものやThunderboltのものにする。

<ul>
<li>速度は Thunderbolt &gt; USB3 &gt;&gt;&gt; USB2(これだけ100BASE-T)</li>
</ul></li>
</ul>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/003_no_router.jpg" alt="" /></p>

<p>それでも速度が遅い場合は、プロバイダを介さない速度テスト(フレッツ光のNGNテスト)をしてみる。</p>

<p>c.f. <a href="https://flets.com/next/square/connectv4/win/">NGNテストのサイトの使い方</a></p>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/004_ngn_test.jpg" alt="" /></p>

<p>ONUとPCを直繋ぎし、PC側でPPPoEでNTTを指定する</p>

<p>macの場合、以下のようになる</p>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/005_create_pppoe.png" alt="" /></p>

<p>左下の <code>+</code> を押し、PPPoEを作成する</p>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/006_config_pppoe.png" alt="" /></p>

<p>アカウント名とパスワードを以下の表のように入力する</p>

<table>
<thead>
<tr>
<th>項目</th>
<th>設定内容</th>
</tr>
</thead>

<tbody>
<tr>
<td>認証方式</td>
<td>PPPoE</td>
</tr>

<tr>
<td>プロバイダ名</td>
<td>任意(なんでもいい、無くても可)</td>
</tr>

<tr>
<td>ユーザー名</td>
<td>guest@v4flets-east.jp</td>
</tr>

<tr>
<td>パスワード</td>
<td>guest</td>
</tr>

<tr>
<td>IPアドレス</td>
<td>自動</td>
</tr>

<tr>
<td>DNS</td>
<td>自動</td>
</tr>
</tbody>
</table>

<p>その後、以下のURLにアクセスすることでテストできる</p>

<p><a href="http://www.v4flets-east.jp">http://www.v4flets-east.jp</a></p>

<p>自分の家の場合は、ほぼ契約通りの理論値(100Mbps)が出た</p>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/007_ngn_test_result.png" alt="" /></p>

<p>ここでも回線が遅い場合は、ONUが古い、壊れている、もしくは光回線の配線が劣化している可能性があるので、NTTに連絡する</p>

<h2 id="なぜ遅いのか">なぜ遅いのか</h2>

<p>ここで振り返ってみる。</p>

<p>自分の環境での測定結果は以下の通りだった</p>

<ul>
<li>ONUは壁の中</li>
<li>ONUとPCは直繋ぎ</li>
<li>PCは2台で試したが結果は同じ</li>
<li>PCは1000BASE-T対応</li>
<li>ケーブルはcat 6</li>
<li>複数のケーブルで試しても結果は同じ</li>
<li>測定結果は0.5Mbps</li>
<li>別の計測サイトでも1Mbps位</li>
<li>NTT NGNの測定結果は99Mbpsでほぼ理論値通り</li>
</ul>

<p>となると、以下のことが推測できる</p>

<ul>
<li>PCは問題ない</li>
<li>ルータも問題ない</li>
<li>ONUも問題ない</li>
<li>ケーブルも問題ない</li>
<li>NTTの(物理的な)回線も問題ない</li>
<li>プロバイダが悪い</li>
</ul>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/008_provider_error.png" alt="" /></p>

<h2 id="遅くなった原因">遅くなった原因</h2>

<p>なぜプロバイダが遅いのか、プロバイダに電話してみる。</p>

<p>測定結果とtracerouteの結果の値をzipで送ったり色々あって…</p>

<p>PPPoE認証サーバの終端、集約装置が混んでいることがわかった。</p>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/009_poi.jpg" alt="" /></p>

<p>しかも<a href="http://www2.softether.jp/jp/ethernext/overview/">PPPoEサーバの管轄はプロバイダでは無くNTT</a>
プロバイダはNTTに増強をお願いするしかできない。
しかしNTTも闇雲に増設は出来るわけがなく(コストとか)、プロバイダのユーザー数が一定数を超えないと増強しない。(増設例: <a href="https://www.so-net.ne.jp/info/2016/sp20160310_0007.html">so-net</a>)</p>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/010_ntt_error.png" alt="" /></p>

<p>じゃあなぜPPPoEが混んでいるか。これはある法律が関係している</p>

<h3 id="2014年まで">~ 2014年まで</h3>

<blockquote>
<p>NTTのフレッツ光は2014年3月末の東西合計の加入件数が1,805万件で、FTTH市場におけるシェアは合わせて71.1%。2013年3月末から1.5ポイント減少した。</p>
</blockquote>

<p>c.f. <a href="https://www.m2ri.jp/news/detail.html?id=107">MM総研: ブロードバンド回線事業者の加入件数調査（2014年3月末時点）</a></p>

<p>光回線は高かった。プロバイダ料込みで6000円前後
そして加入ユーザー数は減っていた</p>

<h3 id="2015年-風向きが変わる">2015年、風向きが変わる</h3>

<p>2015年、NTT法(日本電信電話株式会社等に関する法律)が改正される。</p>

<p>NTTは元国営企業であり、NTT法(第30条第2, 3項)で <strong>NTT東西とドコモは一体的な営業が出来ない</strong> という規制を受けていた。</p>

<blockquote>
<p>2: その電気通信業務について、特定の電気通信事業者に対し、不当に優先的な取扱いをし、若しくは利益を与え、又は不当に不利な取扱いをし、若しくは不利益を与えること。
3: 他の電気通信事業者（第百六十四条第一項各号に掲げる電気通信事業を営む者を含む。）又は電気通信設備の製造業者若しくは販売業者に対し、その業務について、不当に規律をし、又は干渉をすること。</p>
</blockquote>

<p>c.f. <a href="https://dsk.or.jp/dskwiki/index.php?電気通信事業法第30条">情報通信復興会: 電気通信事業法第30条</a></p>

<p>これが以下のように緩和される</p>

<blockquote>
<p>2: 禁止の対象が「グループ会社に対する優遇」のみに限定
3: 廃止</p>
</blockquote>

<p>c.f. <a href="http://www.foresight-law.gr.jp/column/backnumber/170101.html">フォーサイト総合法律事務所: ICT・IoTビジネスと電気通信事業法等の一部改正について</a>
c.f. <a href="http://k-tai.watch.impress.co.jp/docs/interview/639666.html">総務省が進める「競争政策見直し」とは何か</a></p>

<p>NTTはセット販売ができるようになり、 <strong>docomo光</strong> が解禁された。</p>

<p>docomo光は以下の特徴を持つ</p>

<ul>
<li>スマホのパケットし放題の料金をセットにすることで、1台辺り500~2000円割引できる

<ul>
<li>家族で契約してる人は大幅な割引</li>
</ul></li>
<li>docomoショップで契約できる</li>
<li>今までLTEだった人がwifiになったら速度は速くなる(実際は遅いんだけども)</li>
</ul>

<p>つまりdocomoユーザーに対し、抱き合わせで光回線を販売することでユーザー数が増えた</p>

<p>実際にどの位ユーザー数が増加したかというと、</p>

<blockquote>
<p>2015年12月: 契約数100万件突破
2016年6月: 契約数200万件突破
2017年1月: 契約数300万件突破</p>
</blockquote>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/011_docomo.png" alt="" /></p>

<p>c.f. <a href="https://nuro光実測と評判.jp/fletshikari-osoi-hyouban/">実際の速度は800M以上！ NURO光の実測や評判は？: フレッツ光 2016年 急激に遅い評判増える その原因は？</a></p>

<p>docomo光でいかにユーザー数が増加したかが分かる</p>

<p>このユーザー数増加に対し、PPPoEサーバの増強が追いついていない。</p>

<p>そして様々なプロバイダのPPPoEサーバは全てNTT管轄のビル内(POI)にある
= docomoユーザーのPPPoE処理の影響が他プロバイダのPPPoE処理に影響を与える
= プロバイダを変えても意味がない</p>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/012_provier_non.png" alt="" /></p>

<h2 id="どうすれば速くなるか">どうすれば速くなるか</h2>

<p>じゃあどうすればいいか。
要はPPPoEサーバを経由しなければいい。</p>

<p>それが出来る選択肢は以下の2つのみ</p>

<ol>
<li>NNTのPPPoEサーバを迂回しないプロバイダと契約する

<ul>
<li>au光

<ul>
<li>KDDIの回線を利用したサービス</li>
</ul></li>
<li><a href="http://www.spaaqs.ne.jp/">U-NEXT光01(spaaqs光)</a>

<ul>
<li>UCOMの独自回線を利用したサービス</li>
<li>政令指定都市の特定のマンションじゃないと無理</li>
<li>U-NEXT光コラボレーションはダメ</li>
</ul></li>
<li>nuro光

<ul>
<li>NTTの回線だけど、PPPoEなどは独自網</li>
<li>8階建てのマンションだと契約者数4人を超えないと無理</li>
</ul></li>
</ul></li>
<li>IPv6 + IPoEを使う

<ul>
<li>次項で解説</li>
</ul></li>
</ol>

<p>ちなみに、上記以外の1Gbpsのプロバイダで契約したとしても、PPPoEを経由したものは今は良くてもその内同じ問題に当たる</p>

<h2 id="ipv6-ipoeを使う">IPv6+ IPoEを使う</h2>

<h3 id="ipv6">IPv6</h3>

<p>IPv6とはIPv4のIP枯渇問題を解決するために規定されたプロトコル</p>

<p>詳細は<a href="https://ja.wikipedia.org/wiki/IPv6">wikipedia</a>等で参考にするとして、特徴を上げると</p>

<ul>
<li>事実上無限のIPアドレス</li>
<li>IPv4と互換性がない</li>
<li>NATを使わないで端末同士が直接繋がる</li>
<li>IPsecで通信が暗号化される</li>
</ul>

<p>今までは、Webアプリ(apache)やDNS、サーバ側もIPv6に対応しないと接続できなかったので普及していなかった
枯渇問題も、NATを使えば解決できるし…</p>

<p>2015年docomo光以降NTTはNGN(Next Generation Network)、次世代ネットワークに切り替えていく方式(フレッツ光ネクスト)を提供し始めた</p>

<p>これは先程のPPPoEの速度遅いという問題を抱えているが、そのかわりにIPv6を(普及させるため) <strong>無料で</strong> 提供してくれる</p>

<p>が、このままでは既存のサービスを見ることができない</p>

<p>そこでDS-Liteという規格が登場した</p>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/013_ds_lite.png" alt="" /></p>

<h3 id="ds-lite">DS-Lite</h3>

<p>DS-lite(Dual-Stack Lite)とは、RFC6333で規定された通信規格で、IPv6でカプセル化し、その中でIPv4の通信ができる(IPv4 over IPv6)
しかも、<strong>通信速度はIPv6のネットワーク速度</strong>になる</p>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/014_ds_lite_describe.jpg" alt="" /></p>

<p>これにより、IPv6非対応の既存のwebサイトを閲覧することができる</p>

<p>c.f <a href="http://techlog.iij.ad.jp/archives/1254">DS-LiteでIPv4してみませんか？</a></p>

<h3 id="ipoe">IPoE</h3>

<p>話を戻して、速度が遅いのはPPPoEが原因だった
IPv6も最初はPPPoEで接続していた(IPv6 トンネル方式)</p>

<p>しかし新しい方式、IPoE(IPv6 ネイティブ方式)が登場した</p>

<p>IPoEとは IP over Ethernet(ネイティブ方式)の略で、<strong>PPPoEを経由しない</strong>
しかも速度制限はPPPoEでしているので、1Gbps契約じゃなくても1Gbpsが出る可能性がある(200Mbps契約など)</p>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/015_ipoe.jpg" alt="" /></p>

<p>代わりにVNE(Virtual Network Enabler)と呼ばれる、ネイティブ接続事業者(上位プロバイダ)が既存のプロバイダに変わってIPv6で接続する</p>

<p>このVNEはとても少なく、以下しかいない</p>

<ul>
<li>mfeed(インターネットマルチフィード)</li>
<li>JPNE(日本ネットワークイネイブラー)</li>
<li>BBIX</li>
<li>ビッグローブ株式会社(BIGLOBE)</li>
<li>株式会社朝日ネット(ASAHI ネット)</li>
<li>NTT コミュニケーションズ</li>
</ul>

<p>既存のプロバイダでIPv6を利用する場合、以下のようにVNEに移譲している</p>

<table>
<thead>
<tr>
<th>プロバイダ</th>
<th>VNE</th>
</tr>
</thead>

<tbody>
<tr>
<td>IIJmio</td>
<td>mfeed</td>
</tr>

<tr>
<td>GMO とくとく BB</td>
<td>JPNE</td>
</tr>

<tr>
<td>21IP</td>
<td>JPNE</td>
</tr>

<tr>
<td>Yahoo! BB</td>
<td>BBIX</td>
</tr>

<tr>
<td>BIGLOBE</td>
<td>BIGLOBE</td>
</tr>

<tr>
<td>ASAHI ネット</td>
<td>ASAHI ネット</td>
</tr>

<tr>
<td>NTTCom(OCN)</td>
<td>NTTCom(OCN)</td>
</tr>

<tr>
<td>ドコモ net</td>
<td>mfeed</td>
</tr>

<tr>
<td>So-net</td>
<td>mfeed</td>
</tr>
</tbody>
</table>

<p>なので、IPv6でも速度が遅い場合は、違うVNEなプロバイダに切り替える必要がある</p>

<p>c.f. <a href="http://qiita.com/soprano1125/items/65295cd8c371abc6ebe8">IPv6 IPoE に思いを馳せながら ISP をどうやって選定するか考える話</a></p>

<h2 id="使われている事例">使われている事例</h2>

<ul>
<li><a href="https://www.slideshare.net/MasayukiKobayashi/545noc">PyConJP 2014年</a></li>
</ul>

<h2 id="実際にどうすればいいか">実際にどうすればいいか</h2>

<h3 id="ipv6にする">IPv6にする</h3>

<ul>
<li>プロバイダにIPv6を提供しているか電話で確認し、申請する

<ul>
<li>その時、ONUも対応しているか確認してくれる</li>
</ul></li>
<li>NTTでフレッツ・v6オプションを申し込む

<ul>
<li>そこでIPv6固定やDDNSを設定もできる</li>
</ul></li>
<li>ルータと端末(PC, スマホ、タブレット)がIPv6に対応しているものを使う</li>
<li>ルータは <strong>IPv6 パススルー</strong> の機能をonにする必要がある</li>
</ul>

<h3 id="ipv6にしたあとの確認">IPv6にしたあとの確認</h3>

<p>以下のサイトでIPv6で接続できているか確認できる</p>

<p><a href="http://test-ipv6.com/index.html.ja_JP">http://test-ipv6.com/index.html.ja_JP</a></p>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/016_test_ipv6.png" alt="" /></p>

<p>速度はIPv6対応サイトで確認する</p>

<p><a href="http://speedtest6.iijmio.jp">http://speedtest6.iijmio.jp</a></p>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/017_ipv6_speed.png" alt="" /></p>

<p>海外のサイトでも速度チェックできる</p>

<p><a href="http://ipv6-test.com/speedtest">http://ipv6-test.com/speedtest</a></p>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/018_ipv6_speed2.png" alt="" /></p>

<h2 id="結論">結論</h2>

<p>無料なので、IPv6 + IPoEを使おう</p>

<p><img src="//media.githubusercontent.com/media/pyar6329/blog_images/master/2017/03/24/19-00-ipv6/019_flow.png" alt="" /></p>

<h2 id="参考になるサイト">参考になるサイト</h2>

<p><a href="https://note.chiebukuro.yahoo.co.jp/detail/n322584">NTTフレッツ光で通信速度及び応答速度を期待できるおすすめISP</a></p>

    </section>
</article>

<footer id="post-meta" class="clearfix">
    
    <img class="avatar" src="https://b.pyar.bz/images/avatar.png">
    <div>
        <span class="dark">@pyar6329</span>
        <span>I&#39;m programmer.</span>
    </div>
    
    <section id="sharing">
        <a class="twitter" href="https://twitter.com/intent/tweet?text=https%3a%2f%2fb.pyar.bz%2f20170324%2fipv6 - %e3%81%82%e3%81%aa%e3%81%9f%e3%81%ae%e3%81%8a%e5%ae%b6%e3%81%ae%e5%85%89%e5%9b%9e%e7%b7%9a%e9%80%9f%e5%ba%a6%e3%82%92%e4%b8%8a%e3%81%92%e3%82%8b%e6%96%b9%e6%b3%95 "><span class="icon-twitter"> tweet</span></a>

<a class="facebook" href="#" onclick="
    window.open(
      'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
      'facebook-share-dialog',
      'width=626,height=436');
    return false;"><span class="icon-facebook-rect"> Share</span>
</a>

    </section>
</footer>



<ul id="post-list" class="archive readmore">
    <h3>Read more</h3>

    
    
    
        <li>
            <a href="https://b.pyar.bz/20170608/api-uri">APIのURIを短くする<aside class="dates">Jun 8 2017</aside></a>
        </li>
    
        <li>
            <a href="https://b.pyar.bz/20160628/redis-keys">redisのkeyについて調べてみた<aside class="dates">Jun 28 2016</aside></a>
        </li>
    
        <li>
            <a href="https://b.pyar.bz/20141027/rails-timezone">RailsでのtimezoneをUTCにする<aside class="dates">Oct 27 2014</aside></a>
        </li>
    
        <li>
            <a href="https://b.pyar.bz/20141023/has-one">has-oneが動作しなかったのでclass_nameを追加した<aside class="dates">Oct 23 2014</aside></a>
        </li>
    
        <li>
            <a href="https://b.pyar.bz/20141021/mac-postgresql-installation">macでPostgreSQLをインストールする<aside class="dates">Oct 21 2014</aside></a>
        </li>
    
        <li>
            <a href="https://b.pyar.bz/20141021/migrate-command">migrateコマンドを省略する<aside class="dates">Oct 21 2014</aside></a>
        </li>
    
        <li>
            <a href="https://b.pyar.bz/20141021/rake-db-migrate">railsで動作モードを変更する<aside class="dates">Oct 21 2014</aside></a>
        </li>
    
        <li>
            <a href="https://b.pyar.bz/20141021/foreigner">railsに外部キー制約を追加してみた<aside class="dates">Oct 21 2014</aside></a>
        </li>
    
        <li>
            <a href="https://b.pyar.bz/20141016/many-to-many-table">railsで多対多のテーブルを実装する<aside class="dates">Oct 16 2014</aside></a>
        </li>
    
        <li>
            <a href="https://b.pyar.bz/20141016/model">railsのmodelについて調べてみた<aside class="dates">Oct 16 2014</aside></a>
        </li>
    
</ul>



        <footer id="footer">
    
        <div id="social">

	
	
    
    <a class="symbol" href="https://www.github.com/pyar6329">
        github
    </a>
    


</div>

    
    <p class="small">
    
        © Copyright 2017 @pyar6329
    
    </p>
</footer>

    </section>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://b.pyar.bz/js/main.js"></script>
<script src="https://b.pyar.bz/js/highlight.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-47263119-3', 'auto');
ga('send', 'pageview');
</script>


</body>
</html>
